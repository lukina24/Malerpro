<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Malerwissen Pro ‚Äî Admin-Kontrolle</title>

  <style>
    :root {
      --bg: #f5f8ff;
      --text: #222;
      --card: #fff;
      --accent: #0077ff;
    }
    body.dark {
      --bg: #1d1f27;
      --text: #f5f5f5;
      --card: #2a2e3a;
      --accent: #4fa3ff;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      transition: background 0.3s, color 0.3s;
    }
    .container { width: 92%; max-width: 700px; }
    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 28px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      text-align: center;
    }
    input, button { font-family: inherit; }
    input[type="text"], input[type="password"] {
      display: block;
      width: 80%;
      margin: 10px auto;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin: 5px;
    }
    button.secondary {
      background: transparent;
      color: var(--accent);
      border: 1px solid rgba(0,119,255,0.3);
    }
    #error, #reg-error {
      color: #cc2b2b;
      min-height: 1.2em;
    }
    nav {
      margin: 16px 0;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
    }
    nav button.active {
      background: var(--accent);
      color: #fff;
    }
    ul { text-align: left; }
    .danger { background: #d9534f; color: #fff; }
    .small { font-size: 0.9em; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <div id="login-box" class="card">
      <h2>üé® Malerwissen Pro</h2>
      <input type="text" id="username" placeholder="Benutzername">
      <input type="password" id="password" placeholder="Passwort">
      <div>
        <button onclick="login()">Einloggen</button>
        <button class="secondary" onclick="toggleRegister()">Registrieren</button>
      </div>
      <p id="error"></p>
    </div>

    <div id="register-box" class="card" style="display:none;">
      <h2>üìù Registrieren</h2>
      <input type="text" id="reg-username" placeholder="Benutzername">
      <input type="password" id="reg-password" placeholder="Passwort">
      <div>
        <button onclick="register()">Registrieren</button>
        <button class="secondary" onclick="toggleRegister()">Zur√ºck</button>
      </div>
      <p id="reg-error"></p>
    </div>

    <div id="content-box" class="card" style="display:none;">
      <h2 id="welcome-text"></h2>
      <div>
        <button id="mode-btn" onclick="toggleMode()">üåô</button>
        <button onclick="logout()">üö™ Logout</button>
      </div>
      <nav>
        <button data-topic="dashboard" onclick="showTopic('dashboard', this)">üè† √úbersicht</button>
        <button data-topic="fassade" onclick="showTopic('fassade', this)">üè° Fassade</button>
        <button data-topic="wand" onclick="showTopic('wand', this)">üñåÔ∏è Innenwand</button>
        <button data-topic="werkzeug" onclick="showTopic('werkzeug', this)">üß∞ Werkzeuge</button>
        <button data-topic="notizen" onclick="showTopic('notizen', this)">üìù Notizen</button>
      </nav>
      <section id="topic-content"></section>
    </div>
  </div>

  <script>
    const ADMIN_USERNAME = "admin";

    async function hash(t) {
      const data = new TextEncoder().encode(t);
      const hashBuffer = await crypto.subtle.digest("SHA-256", data);
      return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, "0")).join("");
    }

    (async function initAdmin(){
      const users = JSON.parse(localStorage.getItem("users")||"{}");
      if (!users[ADMIN_USERNAME]) {
        users[ADMIN_USERNAME] = await hash("admin123");
        localStorage.setItem("users", JSON.stringify(users));
      }
    })();

    async function login() {
      const u = username.value.trim();
      const p = password.value.trim();
      const users = JSON.parse(localStorage.getItem("users")||"{}");
      if (!users[u]) return error.textContent="‚ùå Benutzer nicht gefunden!";
      const h = await hash(p);
      if (h!==users[u]) return error.textContent="‚ùå Passwort falsch!";
      error.textContent="";
      loginBox.style.display="none";
      registerBox.style.display="none";
      contentBox.style.display="block";
      welcomeText.textContent = (u===ADMIN_USERNAME) ? "üëë Admin angemeldet" : `Hallo ${u}`;
      if (u===ADMIN_USERNAME) showAdminDashboard(); else showTopic("dashboard");
    }

    async function register() {
      const u = regUsername.value.trim(), p = regPassword.value.trim();
      if (!u||!p) return regError.textContent="‚ùå Bitte ausf√ºllen!";
      if (u===ADMIN_USERNAME) return regError.textContent="‚ùå Benutzername 'admin' ist reserviert!";
      const users = JSON.parse(localStorage.getItem("users")||"{}");
      if (users[u]) return regError.textContent="‚ùå Benutzer existiert!";
      users[u] = await hash(p);
      localStorage.setItem("users", JSON.stringify(users));
      regError.textContent="‚úÖ Erfolgreich registriert!";
      regUsername.value=""; regPassword.value="";
    }

    function toggleRegister(){
      loginBox.style.display = loginBox.style.display==="none"?"block":"none";
      registerBox.style.display = registerBox.style.display==="none"?"block":"none";
    }

    function logout(){
      contentBox.style.display="none";
      loginBox.style.display="block";
    }

    function toggleMode(){
      document.body.classList.toggle("dark");
      modeBtn.textContent = document.body.classList.contains("dark")?"‚òÄÔ∏è":"üåô";
    }

    function highlight(btn){
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      if(btn) btn.classList.add("active");
    }

    function showTopic(topic,btn){
      highlight(btn);
      const c = document.getElementById("topic-content");
      if (topic==="dashboard") c.innerHTML="<p>Willkommen bei <b>Malerwissen Pro</b>.</p>";
      else if (topic==="fassade") c.innerHTML="<p>Fassade streichen Anleitung...</p>";
      else if (topic==="wand") c.innerHTML="<p>Innenwand Tipps...</p>";
      else if (topic==="werkzeug") c.innerHTML="<p>Werkzeug√ºbersicht...</p>";
      else if (topic==="notizen") {
        c.innerHTML=`<h3>Notizen</h3><input id='note' placeholder='Neue Notiz...'>
        <button onclick='addNote()'>‚ûï</button><ul id='notes'></ul>`;
        renderNotes();
      }
    }

    function addNote(){
      const t = note.value.trim();
      if (!t) return;
      const arr = JSON.parse(localStorage.getItem("notes")||"[]");
      arr.push(t);
      localStorage.setItem("notes", JSON.stringify(arr));
      note.value=""; renderNotes();
    }
    function renderNotes(){
      const arr = JSON.parse(localStorage.getItem("notes")||"[]");
      notes.innerHTML = arr.map((n,i)=>`<li>${n} <button onclick='delNote(${i})'>‚ùå</button></li>`).join("");
    }
    function delNote(i){
      const arr = JSON.parse(localStorage.getItem("notes")||"[]");
      arr.splice(i,1);
      localStorage.setItem("notes", JSON.stringify(arr));
      renderNotes();
    }

    // ==== ADMIN DASHBOARD ====
    function showAdminDashboard(){
      const c = document.getElementById("topic-content");
      const users = JSON.parse(localStorage.getItem("users")||"{}");
      const notes = JSON.parse(localStorage.getItem("notes")||"[]");

      let userList = Object.keys(users).map(u =>
        `<li>${u} ${u!=="admin"?`<button class='danger' onclick='deleteUser("${u}")'>L√∂schen</button>`:"<span class='small'>(gesch√ºtzt)</span>"}</li>`
      ).join("");

      c.innerHTML = `
        <h3>Admin Dashboard üëë</h3>
        <p><b>Benutzerverwaltung:</b></p>
        <ul>${userList}</ul>
        <button class='danger' onclick='deleteAllUsers()'>‚ö†Ô∏è Alle Benutzer l√∂schen (au√üer Admin)</button>
        <hr>
        <p><b>Notizenverwaltung:</b></p>
        <ul>${notes.map(n=>`<li>${n}</li>`).join("") || "<li>Keine Notizen.</li>"}</ul>
        <button class='danger' onclick='clearAllNotes()'>üóëÔ∏è Alle Notizen l√∂schen</button>
      `;
    }

    function deleteUser(username){
      if (username==="admin") return alert("Admin kann nicht gel√∂scht werden!");
      if (!confirm(`Benutzer "${username}" wirklich l√∂schen?`)) return;
      const users = JSON.parse(localStorage.getItem("users")||"{}");
      delete users[username];
      localStorage.setItem("users", JSON.stringify(users));
      showAdminDashboard();
    }

    function deleteAllUsers(){
      if (!confirm("‚ö†Ô∏è Wirklich ALLE Benutzer (au√üer Admin) l√∂schen?")) return;
      const users = JSON.parse(localStorage.getItem("users")||"{}");
      for (const u in users) if (u!=="admin") delete users[u];
      localStorage.setItem("users", JSON.stringify(users));
      showAdminDashboard();
    }

    function clearAllNotes(){
      if (confirm("Alle Notizen l√∂schen?")) {
        localStorage.setItem("notes","[]");
        showAdminDashboard();
      }
    }
  </script>
</body>
</html>



