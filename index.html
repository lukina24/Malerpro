<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malerwissen Pro ‚Äì Sicher</title>
  <style>
    :root {
      --bg: #f5f8ff;
      --text: #222;
      --card: #fff;
      --accent: #0077ff;
    }
    body.dark {
      --bg: #1d1f27;
      --text: #f5f5f5;
      --card: #2a2e3a;
      --accent: #4fa3ff;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      transition: background 0.3s, color 0.3s;
    }
    .container { width: 90%; max-width: 600px; }
    .card {
      background: var(--card);
      border-radius: 14px;
      padding: 30px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.2);
      text-align: center;
    }
    input {
      display: block;
      width: 80%;
      margin: 10px auto;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1em;
      background: white;
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
      margin: 5px;
    }
    button:hover { transform: scale(1.05); }
    #error, #reg-error { color: red; font-size: 0.9em; margin-top: 10px; }
    nav { margin: 20px 0; }
    header { display: flex; justify-content: space-between; align-items: center; }
    .note { margin-top: 15px; display: flex; gap: 10px; }
    .note input { flex: 1; }
    .note-list {
      margin-top: 10px;
      list-style-type: none;
      padding: 0;
    }
    .note-list li {
      background: rgba(0, 119, 255, 0.1);
      border-left: 4px solid var(--accent);
      padding: 5px 10px;
      margin: 5px 0;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .danger {
      background: #d9534f;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- LOGIN -->
    <div id="login-box" class="card">
      <h2>üé® Willkommen bei Malerwissen Pro</h2>
      <input type="text" id="username" placeholder="Benutzername">
      <input type="password" id="password" placeholder="Passwort">
      <button onclick="login()">Einloggen</button>
      <p>oder <a href="#" onclick="toggleRegister()">Registrieren</a></p>
      <p id="error"></p>
    </div>

    <!-- REGISTRIERUNG -->
    <div id="register-box" class="card" style="display:none;">
      <h2>üìù Registrieren</h2>
      <input type="text" id="reg-username" placeholder="Benutzername">
      <input type="password" id="reg-password" placeholder="Passwort">
      <button onclick="register()">Registrieren</button>
      <p>Bereits registriert? <a href="#" onclick="toggleRegister()">Hier einloggen</a></p>
      <p id="reg-error"></p>
    </div>

    <!-- INHALT -->
    <div id="content-box" class="card" style="display:none;">
      <header>
        <h2 id="welcome-text">Hallo üëã</h2>
        <div>
          <button id="mode-btn" onclick="toggleMode()">üåô</button>
          <button onclick="logout()">üö™ Logout</button>
        </div>
      </header>

      <nav>
        <button onclick="showTopic('dashboard')">üè† √úbersicht</button>
        <button onclick="showTopic('fassade')">üè° Fassade</button>
        <button onclick="showTopic('wand')">üñåÔ∏è Innenwand</button>
        <button onclick="showTopic('werkzeug')">üß∞ Werkzeuge</button>
        <button onclick="showTopic('notizen')">üìù Notizen</button>
      </nav>

      <section id="topic-content"></section>
    </div>
  </div>

  <script>
    // ======= SICHERE HASH-FUNKTION =======
    async function hash(text) {
      const msgUint8 = new TextEncoder().encode(text);
      const hashBuffer = await crypto.subtle.digest("SHA-256", msgUint8);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, "0")).join("");
    }

    // ======= ADMIN INITIALISIERUNG =======
    async function initAdmin() {
      let users = JSON.parse(localStorage.getItem("users") || "{}");
      if (!users["admin"]) {
        const adminHash = await hash("admin123");
        users["admin"] = adminHash;
        localStorage.setItem("users", JSON.stringify(users));
        console.log("üëë Admin wurde erstellt (admin / admin123)");
      }
    }

    window.addEventListener("DOMContentLoaded", initAdmin);

    // ======= LOGIN =======
    async function login() {
      const user = username.value.trim();
      const pass = password.value.trim();
      const users = JSON.parse(localStorage.getItem("users") || "{}");
      const error = document.getElementById("error");
      if (!users[user]) return error.textContent = "‚ùå Benutzer existiert nicht!";
      const passHash = await hash(pass);
      if (users[user] !== passHash) return error.textContent = "‚ùå Passwort falsch!";
      error.textContent = "";
      document.getElementById("login-box").style.display = "none";
      document.getElementById("register-box").style.display = "none";
      document.getElementById("content-box").style.display = "block";
      welcomeText.textContent = (user === "admin") ? "üëë Admin angemeldet" : `Hallo ${user} üëã`;
      if (user === "admin") showAdminDashboard(); else showTopic("dashboard");
    }

    // ======= REGISTRIERUNG =======
    async function register() {
      const user = regUsername.value.trim();
      const pass = regPassword.value.trim();
      const error = document.getElementById("reg-error");

      if (!user || !pass) return error.textContent = "‚ùå Bitte alle Felder ausf√ºllen!";
      if (user === "admin") return error.textContent = "‚ùå 'admin' ist reserviert!";

      let users = JSON.parse(localStorage.getItem("users") || "{}");
      if (users[user]) return error.textContent = "‚ùå Benutzername existiert bereits!";

      const passHash = await hash(pass);
      users[user] = passHash;
      localStorage.setItem("users", JSON.stringify(users));

      error.style.color = "green";
      error.textContent = "‚úÖ Registrierung erfolgreich! Du kannst dich nun einloggen.";
    }

    // ======= TOGGLE =======
    function toggleRegister() {
      loginBox.style.display = loginBox.style.display === "none" ? "block" : "none";
      registerBox.style.display = registerBox.style.display === "none" ? "block" : "none";
      error.textContent = "";
      regError.textContent = "";
    }

    // ======= LOGOUT =======
    function logout() {
      contentBox.style.display = "none";
      loginBox.style.display = "block";
    }

    // ======= DARK/LIGHT MODE =======
    function toggleMode() {
      document.body.classList.toggle("dark");
      modeBtn.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
    }

    // ======= THEMEN =======
    function showTopic(topic) {
      const section = document.getElementById("topic-content");
      let html = "";
      switch (topic) {
        case "dashboard":
          html = `<h3>Willkommen bei Malerwissen üé®</h3><p>W√§hle oben ein Thema aus.</p>`;
          break;
        case "fassade":
          html = `<h3>üè° Fassade streichen</h3><p>Tipps f√ºr Au√üenfassaden...</p>`;
          break;
        case "wand":
          html = `<h3>üñåÔ∏è Innenwand streichen</h3><p>Anleitung f√ºr Innenr√§ume...</p>`;
          break;
        case "werkzeug":
          html = `<h3>üß∞ Werkzeuge</h3><p>Liste n√ºtzlicher Werkzeuge...</p>`;
          break;
        case "notizen":
          html = `<h3>üìù Notizen</h3>
                  <div class="note"><input id="note-input" placeholder="Neue Notiz..."><button onclick="addNote()">‚ûï</button></div>
                  <ul id="note-list" class="note-list"></ul>`;
          break;
      }
      section.innerHTML = html;
      if (topic === "notizen") renderNotes();
    }

    // ======= NOTIZEN =======
    function addNote() {
      const input = document.getElementById("note-input");
      if (!input.value.trim()) return;
      const notes = JSON.parse(localStorage.getItem("notes") || "[]");
      notes.push(input.value.trim());
      localStorage.setItem("notes", JSON.stringify(notes));
      input.value = "";
      renderNotes();
    }

    function renderNotes() {
      const list = document.getElementById("note-list");
      const notes = JSON.parse(localStorage.getItem("notes") || "[]");
      list.innerHTML = notes.map((n, i) => `<li>${n} <button onclick="delNote(${i})">‚ùå</button></li>`).join("");
    }

    function delNote(i) {
      const notes = JSON.parse(localStorage.getItem("notes") || "[]");
      notes.splice(i, 1);
      localStorage.setItem("notes", JSON.stringify(notes));
      renderNotes();
    }

    // ======= ADMIN DASHBOARD =======
    function showAdminDashboard() {
      const section = document.getElementById("topic-content");
      const users = JSON.parse(localStorage.getItem("users") || "{}");
      const notes = JSON.parse(localStorage.getItem("notes") || "[]");

      section.innerHTML = `
        <h3>Admin Dashboard üëë</h3>
        <p><b>Benutzerverwaltung:</b></p>
        <ul>${Object.keys(users).map(u => `<li>${u} ${u !== "admin" ? `<button class='danger' onclick='deleteUser("${u}")'>L√∂schen</button>` : "(gesch√ºtzt)"}</li>`).join("")}</ul>
        <button class='danger' onclick='deleteAllUsers()'>‚ö†Ô∏è Alle Benutzer l√∂schen (au√üer Admin)</button>
        <hr>
        <p><b>Notizen:</b></p>
        <ul>${notes.map(n => `<li>${n}</li>`).join("") || "<li>Keine Notizen.</li>"}</ul>
        <button class='danger' onclick='clearAllNotes()'>üóëÔ∏è Alle Notizen l√∂schen</button>
      `;
    }

    function deleteUser(username) {
      if (username === "admin") return alert("Admin kann nicht gel√∂scht werden!");
      if (!confirm(`Benutzer "${username}" wirklich l√∂schen?`)) return;
      const users = JSON.parse(localStorage.getItem("users") || "{}");
      delete users[username];
      localStorage.setItem("users", JSON.stringify(users));
      showAdminDashboard();
    }

    function deleteAllUsers() {
      if (!confirm("‚ö†Ô∏è Wirklich ALLE Benutzer (au√üer Admin) l√∂schen?")) return;
      const users = JSON.parse(localStorage.getItem("users") || "{}");
      for (const u in users) if (u !== "admin") delete users[u];
      localStorage.setItem("users", JSON.stringify(users));
      showAdminDashboard();
    }

    function clearAllNotes() {
      if (confirm("Alle Notizen l√∂schen?")) {
        localStorage.setItem("notes", "[]");
        showAdminDashboard();
      }
    }
  </script>
</body>
</html>


